{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 136, "column": 0}, "map": {"version":3,"sources":["file:///D:/project/E-commernce-/src/app/lib/db.js"],"sourcesContent":["import mongoose from \"mongoose\";\r\n\r\nconst connectDB = async () => {\r\n  if (mongoose.connections[0].readyState) return;\r\n\r\n  try {\r\n    await mongoose.connect(process.env.MONGODB_URI);\r\n    console.log(\"MongoDB connected\");\r\n  } catch (error) {\r\n    console.error(\"MongoDB connection error:\", error);\r\n  }\r\n};\r\n\r\nexport default connectDB;\r\n"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM,YAAY;IAChB,IAAI,oHAAQ,CAAC,WAAW,CAAC,EAAE,CAAC,UAAU,EAAE;IAExC,IAAI;QACF,MAAM,oHAAQ,CAAC,OAAO,CAAC,QAAQ,GAAG,CAAC,WAAW;QAC9C,QAAQ,GAAG,CAAC;IACd,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,6BAA6B;IAC7C;AACF;uCAEe","debugId":null}},
    {"offset": {"line": 156, "column": 0}, "map": {"version":3,"sources":["file:///D:/project/E-commernce-/src/app/models/orderModel.js"],"sourcesContent":["// models/orderModel.js\r\nimport mongoose from \"mongoose\";\r\n\r\nconst orderSchema = new mongoose.Schema({\r\n  userId: { type: mongoose.Schema.Types.ObjectId, ref: \"User\", required: true },\r\n  items: [\r\n    {\r\n      productId: { type: mongoose.Schema.Types.ObjectId, ref: \"Product\" },\r\n      quantity: Number,\r\n      price: Number,\r\n    },\r\n  ],\r\n  totalAmount: Number,\r\n  address: String,\r\n  paymentMethod: String,\r\n  status: String,\r\n  razorpayOrderId: String,\r\n}, { timestamps: true });\r\n\r\nexport default mongoose.models.Order || mongoose.model(\"Order\", orderSchema);\r\n"],"names":[],"mappings":"AAAA,uBAAuB;;;;;AACvB;;AAEA,MAAM,cAAc,IAAI,oHAAQ,CAAC,MAAM,CAAC;IACtC,QAAQ;QAAE,MAAM,oHAAQ,CAAC,MAAM,CAAC,KAAK,CAAC,QAAQ;QAAE,KAAK;QAAQ,UAAU;IAAK;IAC5E,OAAO;QACL;YACE,WAAW;gBAAE,MAAM,oHAAQ,CAAC,MAAM,CAAC,KAAK,CAAC,QAAQ;gBAAE,KAAK;YAAU;YAClE,UAAU;YACV,OAAO;QACT;KACD;IACD,aAAa;IACb,SAAS;IACT,eAAe;IACf,QAAQ;IACR,iBAAiB;AACnB,GAAG;IAAE,YAAY;AAAK;uCAEP,oHAAQ,CAAC,MAAM,CAAC,KAAK,IAAI,oHAAQ,CAAC,KAAK,CAAC,SAAS","debugId":null}},
    {"offset": {"line": 192, "column": 0}, "map": {"version":3,"sources":["file:///D:/project/E-commernce-/src/app/models/cartModel.js"],"sourcesContent":["import mongoose from \"mongoose\";\r\n\r\nconst cartSchema = new mongoose.Schema({\r\n  userId: { type: mongoose.Schema.Types.ObjectId, ref: \"User\", required: true },\r\n  items: [\r\n    {\r\n      productId: {\r\n        type: mongoose.Schema.Types.ObjectId,\r\n        ref: \"Product\",\r\n        required: true,\r\n      },\r\n      quantity: { type: Number, required: true, min: 1 },\r\n    },\r\n  ],\r\n});\r\n\r\nconst Cart = mongoose.models.Cart || mongoose.model(\"Cart\", cartSchema);\r\nexport default Cart;\r\n"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM,aAAa,IAAI,oHAAQ,CAAC,MAAM,CAAC;IACrC,QAAQ;QAAE,MAAM,oHAAQ,CAAC,MAAM,CAAC,KAAK,CAAC,QAAQ;QAAE,KAAK;QAAQ,UAAU;IAAK;IAC5E,OAAO;QACL;YACE,WAAW;gBACT,MAAM,oHAAQ,CAAC,MAAM,CAAC,KAAK,CAAC,QAAQ;gBACpC,KAAK;gBACL,UAAU;YACZ;YACA,UAAU;gBAAE,MAAM;gBAAQ,UAAU;gBAAM,KAAK;YAAE;QACnD;KACD;AACH;AAEA,MAAM,OAAO,oHAAQ,CAAC,MAAM,CAAC,IAAI,IAAI,oHAAQ,CAAC,KAAK,CAAC,QAAQ;uCAC7C","debugId":null}},
    {"offset": {"line": 225, "column": 0}, "map": {"version":3,"sources":["file:///D:/project/E-commernce-/src/app/api/order/route.js"],"sourcesContent":["import { NextResponse } from \"next/server\";\r\nimport Razorpay from \"razorpay\";\r\nimport connectDB from \"../../lib/db.js\";\r\nimport Order from \"../../models/orderModel.js\";\r\nimport Cart from \"../../models/cartModel.js\";\r\n\r\n// ‚úÖ Initialize Razorpay\r\nconst razorpay = new Razorpay({\r\n  key_id: process.env.RAZORPAY_KEY_ID,\r\n  key_secret: process.env.RAZORPAY_KEY_SECRET,\r\n});\r\n\r\nexport async function POST(req) {\r\n  try {\r\n    await connectDB();\r\n\r\n    const { userId, address, paymentMethod } = await req.json();\r\n\r\n    // ‚úÖ Fetch cart\r\n    const cart = await Cart.findOne({ userId }).populate(\"items.productId\");\r\n    if (!cart || cart.items.length === 0) {\r\n      return NextResponse.json({ message: \"Cart is empty\" }, { status: 400 });\r\n    }\r\n\r\n    // ‚úÖ Calculate total amount\r\n    const totalAmount = cart.items.reduce(\r\n      (acc, item) => acc + item.productId.price * item.quantity,\r\n      0\r\n    );\r\n\r\n    // ‚úÖ COD order\r\n    if (paymentMethod === \"COD\") {\r\n      const newOrder = new Order({\r\n        userId,\r\n        items: cart.items.map((item) => ({\r\n          productId: item.productId._id,\r\n          quantity: item.quantity,\r\n          price: item.productId.price,\r\n        })),\r\n        totalAmount,\r\n        address,\r\n        paymentMethod: \"COD\",\r\n        status: \"Pending\",\r\n      });\r\n\r\n      await newOrder.save();\r\n\r\n      // Clear cart\r\n      cart.items = [];\r\n      await cart.save();\r\n\r\n      return NextResponse.json(\r\n        { message: \"Order placed successfully (COD)\", order: newOrder },\r\n        { status: 201 }\r\n      );\r\n    }\r\n\r\n    // ‚úÖ Razorpay Online Payment\r\n    if (paymentMethod === \"Online\") {\r\n      const options = {\r\n        amount: totalAmount * 1, // amount in paise\r\n        currency: \"INR\",\r\n        receipt: `receipt_${Date.now()}`,\r\n        notes: {\r\n          userId,\r\n          address,\r\n        },\r\n      };\r\n\r\n      const razorpayOrder = await razorpay.orders.create(options);\r\n\r\n      // Temporary save (status: \"Pending Payment\")\r\n      const newOrder = new Order({\r\n        userId,\r\n        items: cart.items.map((item) => ({\r\n          productId: item.productId._id,\r\n          quantity: item.quantity,\r\n          price: item.productId.price,\r\n        })),\r\n        totalAmount,\r\n        address,\r\n        paymentMethod: \"Online\",\r\n        status: \"Pending\",\r\n        razorpayOrderId: razorpayOrder.id,\r\n      });\r\n\r\n      await newOrder.save();\r\n\r\n      return NextResponse.json(\r\n        {\r\n          id: razorpayOrder.id,\r\n          amount: razorpayOrder.amount,\r\n          currency: razorpayOrder.currency,\r\n          key: process.env.NEXT_PUBLIC_RAZORPAY_KEY_ID,\r\n        },\r\n        { status: 200 }\r\n      );\r\n    }\r\n\r\n    return NextResponse.json(\r\n      { message: \"Invalid payment method\" },\r\n      { status: 400 }\r\n    );\r\n  } catch (error) {\r\n    console.error(\"Order POST error:\", error);\r\n    return NextResponse.json(\r\n      { message: \"Error processing order\", error: error.message },\r\n      { status: 500 }\r\n    );\r\n  }\r\n}\r\n\r\n\r\nexport async function GET(req) {\r\n  try {\r\n    await connectDB();\r\n\r\n    // Get userId from query (optional)\r\n    const { searchParams } = new URL(req.url);\r\n    const userId = searchParams.get(\"userId\");\r\n\r\n    let orders;\r\n\r\n    if (userId) {\r\n      // üßç Fetch specific user's orders\r\n      orders = await Order.find({ userId })\r\n        .populate(\"items.productId\", \"name price\")\r\n        .sort({ createdAt: -1 });\r\n    } else {\r\n      // üßë‚Äçüíº Admin fetch all orders\r\n      orders = await Order.find()\r\n        .populate(\"userId\", \"username email\")\r\n        .populate(\"items.productId\", \"name price\")\r\n        .sort({ createdAt: -1 });\r\n    }\r\n\r\n    if (!orders || orders.length === 0) {\r\n      return NextResponse.json({ message: \"No orders found\" }, { status: 404 });\r\n    }\r\n\r\n    return NextResponse.json({ orders }, { status: 200 });\r\n  } catch (error) {\r\n    console.error(\"Order GET error:\", error);\r\n    return NextResponse.json(\r\n      { message: \"Error fetching orders\", error: error.message },\r\n      { status: 500 }\r\n    );\r\n  }\r\n}"],"names":[],"mappings":"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","debugId":null}}]
}