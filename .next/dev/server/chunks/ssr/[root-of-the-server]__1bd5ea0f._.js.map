{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 88, "column": 0}, "map": {"version":3,"sources":["file:///D:/project/E-commernce-/src/app/admin-dashboard/order/page.jsx"],"sourcesContent":["\"use client\";\r\nimport { useEffect, useState } from \"react\";\r\nimport axios from \"axios\";\r\nimport { CheckCircle, Clock, CreditCard, Loader2 } from \"lucide-react\";\r\nimport { toast } from \"react-toastify\";\r\n\r\nexport default function OrderTable() {\r\n  const [orders, setOrders] = useState([]);\r\n  const [loading, setLoading] = useState(true);\r\n  const [updatingId, setUpdatingId] = useState(null);\r\n\r\n  // üîπ Fetch orders for logged-in user\r\n  useEffect(() => {\r\n    const fetchOrders = async () => {\r\n      try {\r\n        // ‚úÖ Try to get userId from localStorage\r\n        let userId = localStorage.getItem(\"userId\");\r\n\r\n        // If not present, fetch from API (or you can set it manually after login)\r\n        if (!userId) {\r\n          // Example: If your backend returns user info along with orders\r\n          const res = await axios.get(\"http://localhost:3001/api/order\");\r\n          if (res.data?.[0]?.userId?._id) {\r\n            userId = res.data[0].userId._id;\r\n            localStorage.setItem(\"userId\", userId); // ‚úÖ store it for next time\r\n          }\r\n        }\r\n\r\n        // Now fetch all orders related to that user\r\n        const res = await axios.get(`http://localhost:3001/api/order`);\r\n        let data = res.data;\r\n\r\n        // Optional: filter client-side to show only that user's orders\r\n        const filteredOrders = Array.isArray(data)\r\n          ? data.filter((order) => order.userId?._id === userId)\r\n          : [];\r\n\r\n        setOrders(filteredOrders);\r\n        setLoading(false);\r\n      } catch (error) {\r\n        console.error(error);\r\n        toast.error(\"Failed to fetch your orders!\");\r\n        setLoading(false);\r\n      }\r\n    };\r\n\r\n    fetchOrders();\r\n  }, []);\r\n\r\n  // üîπ Update order status and use userId from localStorage\r\n  const handleStatusChange = async (orderId, newStatus) => {\r\n    try {\r\n      const userId = localStorage.getItem(\"userId\"); // ‚úÖ get from localStorage\r\n      if (!userId) {\r\n        toast.error(\"User ID not found. Please log in again.\");\r\n        return;\r\n      }\r\n\r\n      setUpdatingId(orderId);\r\n\r\n      await axios.put(`http://localhost:3001/api/order/${orderId}`, {\r\n        status: newStatus,\r\n        userId, // ‚úÖ Send userId for backend tracking\r\n      });\r\n\r\n      // ‚úÖ Update UI instantly\r\n      setOrders((prevOrders) =>\r\n        prevOrders.map((order) =>\r\n          order._id === orderId ? { ...order, status: newStatus } : order\r\n        )\r\n      );\r\n\r\n      toast.success(`Order status updated to ${newStatus}`);\r\n    } catch (error) {\r\n      console.error(error);\r\n      toast.error(\"Failed to update order status\");\r\n    } finally {\r\n      setUpdatingId(null);\r\n    }\r\n  };\r\n\r\n  const getStatusIcon = (status) => {\r\n    switch (status) {\r\n      case \"Pending\":\r\n        return <Clock className=\"text-yellow-500\" />;\r\n      case \"Completed\":\r\n        return <CheckCircle className=\"text-green-500\" />;\r\n      default:\r\n        return <Clock className=\"text-gray-400\" />;\r\n    }\r\n  };\r\n\r\n  if (loading) {\r\n    return (\r\n      <div className=\"flex items-center justify-center min-h-screen text-lg text-black\">\r\n        ‚è≥ Loading your orders...\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"p-2 min-h-screen\">\r\n      <div className=\"max-w-6xl mx-auto p-6\">\r\n        <h2 className=\"text-2xl font-semibold mb-4 text-gray-800\">\r\n          üßæ My Orders\r\n        </h2>\r\n\r\n        {orders.length === 0 ? (\r\n          <p className=\"text-gray-500 text-center py-10\">\r\n            No orders found for your account.\r\n          </p>\r\n        ) : (\r\n          <div className=\"overflow-x-auto\">\r\n            <table className=\"min-w-full border border-gray-200 rounded-lg overflow-hidden\">\r\n              <thead className=\"bg-gray-100 text-gray-700 text-sm uppercase\">\r\n                <tr>\r\n                  <th className=\"px-6 py-3 text-left\">User</th>\r\n                  <th className=\"px-6 py-3 text-left\">Items</th>\r\n                  <th className=\"px-6 py-3 text-center\">Total</th>\r\n                  <th className=\"px-6 py-3 text-left\">Address</th>\r\n                  <th className=\"px-6 py-3 text-center\">Payment</th>\r\n                  <th className=\"px-6 py-3 text-center\">Status</th>\r\n                  <th className=\"px-6 py-3 text-center\">Order ID</th>\r\n                  <th className=\"px-6 py-3 text-center\">Order Date</th>\r\n                </tr>\r\n              </thead>\r\n\r\n              <tbody className=\"text-sm text-gray-800\">\r\n                {orders.map((order) => (\r\n                  <tr\r\n                    key={order._id}\r\n                    className=\"border-t hover:bg-gray-50 transition-all duration-200\"\r\n                  >\r\n                    {/* üßç User Info */}\r\n                    <td className=\"px-6 py-3\">\r\n                      <div className=\"flex flex-col\">\r\n                        <span className=\"font-semibold\">\r\n                          {order.userId?.username || \"You\"}\r\n                        </span>\r\n                        <span className=\"text-gray-500 text-xs\">\r\n                          {order.userId?.email || \"No email\"}\r\n                        </span>\r\n                      </div>\r\n                    </td>\r\n\r\n                    {/* üì¶ Items */}\r\n                    <td className=\"px-6 py-3\">\r\n                      {order.items?.map((item, i) => (\r\n                        <div key={i}>\r\n                          {item.name || \"Item\"} - ‚Çπ{item.price || 0}\r\n                        </div>\r\n                      ))}\r\n                    </td>\r\n\r\n                    {/* üí∞ Total */}\r\n                    <td className=\"px-6 py-3 text-center font-semibold text-blue-600\">\r\n                      ‚Çπ{order.totalAmount}\r\n                    </td>\r\n\r\n                    {/* üè† Address */}\r\n                    <td className=\"px-6 py-3\">{order.address}</td>\r\n\r\n                    {/* üí≥ Payment */}\r\n                    <td className=\"px-6 py-3 text-center\">\r\n                      <div className=\"flex items-center justify-center gap-2\">\r\n                        <CreditCard className=\"text-gray-500\" size={16} />\r\n                        <span>{order.paymentMethod}</span>\r\n                      </div>\r\n                    </td>\r\n\r\n                    {/* üìå Status */}\r\n                    <td className=\"px-6 py-3 text-center\">\r\n                      <div className=\"flex items-center justify-center gap-2\">\r\n                        {getStatusIcon(order.status)}\r\n                        <select\r\n                          value={order.status}\r\n                          onChange={(e) =>\r\n                            handleStatusChange(order._id, e.target.value)\r\n                          }\r\n                          disabled={updatingId === order._id}\r\n                          className={`border text-sm rounded-lg px-2 py-1 outline-none ${\r\n                            order.status === \"Pending\"\r\n                              ? \"text-yellow-600 border-yellow-400\"\r\n                              : \"text-green-600 border-green-400\"\r\n                          }`}\r\n                        >\r\n                          <option value=\"Pending\">Pending</option>\r\n                          <option value=\"Completed\">Completed</option>\r\n                          <option value=\"Cancelled\">Cancelled</option>\r\n                        </select>\r\n\r\n                        {updatingId === order._id && (\r\n                          <Loader2\r\n                            className=\"animate-spin text-gray-500\"\r\n                            size={16}\r\n                          />\r\n                        )}\r\n                      </div>\r\n                    </td>\r\n\r\n                    {/* üßæ Razorpay Order ID */}\r\n                    <td className=\"px-6 py-3 text-center font-mono text-gray-500\">\r\n                      {order.razorpayOrderId}\r\n                    </td>\r\n\r\n                    {/* üìÖ Date */}\r\n                    <td className=\"px-6 py-3 text-center text-gray-500\">\r\n                      {new Date(order.createdAt).toLocaleString()}\r\n                    </td>\r\n                  </tr>\r\n                ))}\r\n              </tbody>\r\n            </table>\r\n          </div>\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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","debugId":null}}]
}