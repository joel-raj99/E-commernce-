{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["D:/project/E-commernce-/src/app/admin-dashboard/order/page.jsx"],"sourcesContent":["\"use client\";\r\nimport { useEffect, useState } from \"react\";\r\nimport axios from \"axios\";\r\nimport { CheckCircle, Clock, CreditCard, Loader2 } from \"lucide-react\";\r\nimport { toast } from \"react-toastify\";\r\n\r\nexport default function OrderTable() {\r\n  const [orders, setOrders] = useState([]);\r\n  const [loading, setLoading] = useState(true);\r\n  const [updatingId, setUpdatingId] = useState(null);\r\n\r\n  // üîπ Fetch orders for logged-in user\r\n  useEffect(() => {\r\n    const fetchOrders = async () => {\r\n      try {\r\n        // ‚úÖ Try to get userId from localStorage\r\n        let userId = localStorage.getItem(\"userId\");\r\n\r\n        // If not present, fetch from API (or you can set it manually after login)\r\n        if (!userId) {\r\n          // Example: If your backend returns user info along with orders\r\n          const res = await axios.get(\"http://localhost:3001/api/order\");\r\n          if (res.data?.[0]?.userId?._id) {\r\n            userId = res.data[0].userId._id;\r\n            localStorage.setItem(\"userId\", userId); // ‚úÖ store it for next time\r\n          }\r\n        }\r\n\r\n        // Now fetch all orders related to that user\r\n        const res = await axios.get(`http://localhost:3001/api/order`);\r\n        let data = res.data;\r\n\r\n        // Optional: filter client-side to show only that user's orders\r\n        const filteredOrders = Array.isArray(data)\r\n          ? data.filter((order) => order.userId?._id === userId)\r\n          : [];\r\n\r\n        setOrders(filteredOrders);\r\n        setLoading(false);\r\n      } catch (error) {\r\n        console.error(error);\r\n        toast.error(\"Failed to fetch your orders!\");\r\n        setLoading(false);\r\n      }\r\n    };\r\n\r\n    fetchOrders();\r\n  }, []);\r\n\r\n  // üîπ Update order status and use userId from localStorage\r\n  const handleStatusChange = async (orderId, newStatus) => {\r\n    try {\r\n      const userId = localStorage.getItem(\"userId\"); // ‚úÖ get from localStorage\r\n      if (!userId) {\r\n        toast.error(\"User ID not found. Please log in again.\");\r\n        return;\r\n      }\r\n\r\n      setUpdatingId(orderId);\r\n\r\n      await axios.put(`http://localhost:3001/api/order/${orderId}`, {\r\n        status: newStatus,\r\n        userId, // ‚úÖ Send userId for backend tracking\r\n      });\r\n\r\n      // ‚úÖ Update UI instantly\r\n      setOrders((prevOrders) =>\r\n        prevOrders.map((order) =>\r\n          order._id === orderId ? { ...order, status: newStatus } : order\r\n        )\r\n      );\r\n\r\n      toast.success(`Order status updated to ${newStatus}`);\r\n    } catch (error) {\r\n      console.error(error);\r\n      toast.error(\"Failed to update order status\");\r\n    } finally {\r\n      setUpdatingId(null);\r\n    }\r\n  };\r\n\r\n  const getStatusIcon = (status) => {\r\n    switch (status) {\r\n      case \"Pending\":\r\n        return <Clock className=\"text-yellow-500\" />;\r\n      case \"Completed\":\r\n        return <CheckCircle className=\"text-green-500\" />;\r\n      default:\r\n        return <Clock className=\"text-gray-400\" />;\r\n    }\r\n  };\r\n\r\n  if (loading) {\r\n    return (\r\n      <div className=\"flex items-center justify-center min-h-screen text-lg text-black\">\r\n        ‚è≥ Loading your orders...\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"p-2 min-h-screen\">\r\n      <div className=\"max-w-6xl mx-auto p-6\">\r\n        <h2 className=\"text-2xl font-semibold mb-4 text-gray-800\">\r\n          üßæ My Orders\r\n        </h2>\r\n\r\n        {orders.length === 0 ? (\r\n          <p className=\"text-gray-500 text-center py-10\">\r\n            No orders found for your account.\r\n          </p>\r\n        ) : (\r\n          <div className=\"overflow-x-auto\">\r\n            <table className=\"min-w-full border border-gray-200 rounded-lg overflow-hidden\">\r\n              <thead className=\"bg-gray-100 text-gray-700 text-sm uppercase\">\r\n                <tr>\r\n                  <th className=\"px-6 py-3 text-left\">User</th>\r\n                  <th className=\"px-6 py-3 text-left\">Items</th>\r\n                  <th className=\"px-6 py-3 text-center\">Total</th>\r\n                  <th className=\"px-6 py-3 text-left\">Address</th>\r\n                  <th className=\"px-6 py-3 text-center\">Payment</th>\r\n                  <th className=\"px-6 py-3 text-center\">Status</th>\r\n                  <th className=\"px-6 py-3 text-center\">Order ID</th>\r\n                  <th className=\"px-6 py-3 text-center\">Order Date</th>\r\n                </tr>\r\n              </thead>\r\n\r\n              <tbody className=\"text-sm text-gray-800\">\r\n                {orders.map((order) => (\r\n                  <tr\r\n                    key={order._id}\r\n                    className=\"border-t hover:bg-gray-50 transition-all duration-200\"\r\n                  >\r\n                    {/* üßç User Info */}\r\n                    <td className=\"px-6 py-3\">\r\n                      <div className=\"flex flex-col\">\r\n                        <span className=\"font-semibold\">\r\n                          {order.userId?.username || \"You\"}\r\n                        </span>\r\n                        <span className=\"text-gray-500 text-xs\">\r\n                          {order.userId?.email || \"No email\"}\r\n                        </span>\r\n                      </div>\r\n                    </td>\r\n\r\n                    {/* üì¶ Items */}\r\n                    <td className=\"px-6 py-3\">\r\n                      {order.items?.map((item, i) => (\r\n                        <div key={i}>\r\n                          {item.name || \"Item\"} - ‚Çπ{item.price || 0}\r\n                        </div>\r\n                      ))}\r\n                    </td>\r\n\r\n                    {/* üí∞ Total */}\r\n                    <td className=\"px-6 py-3 text-center font-semibold text-blue-600\">\r\n                      ‚Çπ{order.totalAmount}\r\n                    </td>\r\n\r\n                    {/* üè† Address */}\r\n                    <td className=\"px-6 py-3\">{order.address}</td>\r\n\r\n                    {/* üí≥ Payment */}\r\n                    <td className=\"px-6 py-3 text-center\">\r\n                      <div className=\"flex items-center justify-center gap-2\">\r\n                        <CreditCard className=\"text-gray-500\" size={16} />\r\n                        <span>{order.paymentMethod}</span>\r\n                      </div>\r\n                    </td>\r\n\r\n                    {/* üìå Status */}\r\n                    <td className=\"px-6 py-3 text-center\">\r\n                      <div className=\"flex items-center justify-center gap-2\">\r\n                        {getStatusIcon(order.status)}\r\n                        <select\r\n                          value={order.status}\r\n                          onChange={(e) =>\r\n                            handleStatusChange(order._id, e.target.value)\r\n                          }\r\n                          disabled={updatingId === order._id}\r\n                          className={`border text-sm rounded-lg px-2 py-1 outline-none ${\r\n                            order.status === \"Pending\"\r\n                              ? \"text-yellow-600 border-yellow-400\"\r\n                              : \"text-green-600 border-green-400\"\r\n                          }`}\r\n                        >\r\n                          <option value=\"Pending\">Pending</option>\r\n                          <option value=\"Completed\">Completed</option>\r\n                          <option value=\"Cancelled\">Cancelled</option>\r\n                        </select>\r\n\r\n                        {updatingId === order._id && (\r\n                          <Loader2\r\n                            className=\"animate-spin text-gray-500\"\r\n                            size={16}\r\n                          />\r\n                        )}\r\n                      </div>\r\n                    </td>\r\n\r\n                    {/* üßæ Razorpay Order ID */}\r\n                    <td className=\"px-6 py-3 text-center font-mono text-gray-500\">\r\n                      {order.razorpayOrderId}\r\n                    </td>\r\n\r\n                    {/* üìÖ Date */}\r\n                    <td className=\"px-6 py-3 text-center text-gray-500\">\r\n                      {new Date(order.createdAt).toLocaleString()}\r\n                    </td>\r\n                  </tr>\r\n                ))}\r\n              </tbody>\r\n            </table>\r\n          </div>\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n"],"names":["useEffect","useState","axios","CheckCircle","Clock","CreditCard","Loader2","toast","OrderTable","orders","setOrders","loading","setLoading","updatingId","setUpdatingId","fetchOrders","userId","localStorage","getItem","res","get","data","_id","setItem","filteredOrders","Array","isArray","filter","order","error","console","handleStatusChange","orderId","newStatus","put","status","prevOrders","map","success","getStatusIcon","length","username","email","items","item","i","name","price","totalAmount","address","paymentMethod","e","target","value","razorpayOrderId","Date","createdAt","toLocaleString"],"mappings":";;;;;AACA,SAASA,SAAS,EAAEC,QAAQ,QAAQ,OAAO;AAC3C,OAAOC,KAAK,MAAM,OAAO;AACzB,SAASC,WAAW,EAAEC,KAAK,EAAEC,UAAU,EAAEC,OAAO,QAAQ,cAAc;;;;AACtE,SAASC,KAAK,QAAQ,gBAAgB;;;AAJtC,YAAY;;;;;AAMG;;IACb,MAAM,CAACE,MAAM,EAAEC,SAAS,CAAC,OAAGT,yKAAQ,EAAC,EAAE,CAAC;IACxC,MAAM,CAACU,OAAO,EAAEC,UAAU,CAAC,OAAGX,yKAAQ,EAAC,IAAI,CAAC;IAC5C,MAAM,CAACY,UAAU,EAAEC,aAAa,CAAC,OAAGb,yKAAQ,EAAC,IAAI,CAAC;IAElD,qCAAA;QACAD,0KAAS;gCAAC,MAAM;YACd,MAAMe,WAAW;oDAAG,MAAAA,CAAA,KAAY;oBAC9B,IAAI;wBACF,wCAAA;wBACA,IAAIC,MAAM,GAAGC,YAAY,CAACC,OAAO,CAAC,QAAQ,CAAC;wBAE3C,0EAAA;wBACA,IAAI,CAACF,MAAM,EAAE;4BACX,+DAAA;4BACA,MAAMG,GAAG,GAAG,MAAMjB,mJAAK,CAACkB,GAAG,CAAC,iCAAiC,CAAC;4BAC9D,IAAID,GAAG,CAACE,IAAI,EAAA,CAAG,CAAC,CAAC,EAAEL,MAAM,EAAEM,GAAG,EAAE;gCAC9BN,MAAM,GAAGG,GAAG,CAACE,IAAI,CAAC,CAAC,CAAC,CAACL,MAAM,CAACM,GAAG;gCAC/BL,YAAY,CAACM,OAAO,CAAC,QAAQ,EAAEP,MAAM,CAAC,CAAC,CAAC,2BAAA;4BAC1C;wBACF;wBAEA,4CAAA;wBACA,MAAMG,KAAG,GAAG,MAAMjB,mJAAK,CAACkB,GAAG,CAAC,CAAA,+BAAA,CAAiC,CAAC;wBAC9D,IAAIC,IAAI,GAAGF,KAAG,CAACE,IAAI;wBAEnB,+DAAA;wBACA,MAAMG,cAAc,GAAGC,KAAK,CAACC,OAAO,CAACL,IAAI,CAAC,GACtCA,IAAI,CAACM,MAAM;gEAAEC,KAAK,IAAKA,KAAK,CAACZ,MAAM,EAAEM,GAAG,KAAKN,MAAM,CAAC;iEACpD,EAAE;wBAENN,SAAS,CAACc,cAAc,CAAC;wBACzBZ,UAAU,CAAC,KAAK,CAAC;oBACnB,CAAC,CAAC,OAAOiB,KAAK,EAAE;wBACdC,OAAO,CAACD,KAAK,CAACA,KAAK,CAAC;wBACpBtB,+JAAK,CAACsB,KAAK,CAAC,8BAA8B,CAAC;wBAC3CjB,UAAU,CAAC,KAAK,CAAC;oBACnB;gBACF,CAAC;;YAEDG,WAAW,CAAC,CAAC;QACf,CAAC;+BAAE,EAAE,CAAC;IAEN,0DAAA;IACA,MAAMgB,kBAAkB,GAAG,MAAAA,CAAOC,OAAO,EAAEC,SAAS,KAAK;QACvD,IAAI;YACF,MAAMjB,QAAM,GAAGC,YAAY,CAACC,OAAO,CAAC,QAAQ,CAAC,CAAC,CAAC,0BAAA;YAC/C,IAAI,CAACF,QAAM,EAAE;gBACXT,+JAAK,CAACsB,KAAK,CAAC,yCAAyC,CAAC;gBACtD;YACF;YAEAf,aAAa,CAACkB,OAAO,CAAC;YAEtB,MAAM9B,mJAAK,CAACgC,GAAG,CAAC,CAAA,gCAAA,EAAmCF,OAAO,EAAE,EAAE;gBAC5DG,MAAM,EAAEF,SAAS;gBACjBjB,MAAM,EAANA,QAAM,CAAE,qCAAA;YACV,CAAC,CAAC;YAEF,wBAAA;YACAN,SAAS,CAAE0B,UAAU,IACnBA,UAAU,CAACC,GAAG,EAAET,OAAK,GACnBA,OAAK,CAACN,GAAG,KAAKU,OAAO,GAAG;wBAAE,GAAGJ,OAAK;wBAAEO,MAAM,EAAEF;oBAAU,CAAC,GAAGL,OAC5D,CACF,CAAC;YAEDrB,+JAAK,CAAC+B,OAAO,CAAC,CAAA,wBAAA,EAA2BL,SAAS,EAAE,CAAC;QACvD,CAAC,CAAC,OAAOJ,OAAK,EAAE;YACdC,OAAO,CAACD,KAAK,CAACA,OAAK,CAAC;YACpBtB,+JAAK,CAACsB,KAAK,CAAC,+BAA+B,CAAC;QAC9C,CAAC,QAAS;YACRf,aAAa,CAAC,IAAI,CAAC;QACrB;IACF,CAAC;IAED,MAAMyB,aAAa,IAAIJ,MAAM,IAAK;QAChC,OAAQA,MAAM;YACZ,KAAK,SAAS;gBACZ,qBAAO,6LAAC,gNAAK;oBAAC,SAAS,EAAC,iBAAiB,GAAG;;;;;;YAC9C,KAAK,WAAW;gBACd,qBAAO,6LAAC,6OAAW;oBAAC,SAAS,EAAC,gBAAgB,GAAG;;;;;;YACnD;gBACE,qBAAO,6LAAC,gNAAK;oBAAC,SAAS,EAAC,eAAe,GAAG;;;;;;QAC9C;IACF,CAAC;IAED,IAAIxB,OAAO,EAAE;QACX,qBACE,6LAAC,GAAG;YAAC,SAAS,EAAC,kEAAkE;sBAAC;;;;;;IAItF;IAEA,qBACE,6LAAC,GAAG;QAAC,SAAS,EAAC,kBAAkB,CAAC;gCAChC,6LAAC,GAAG;YAAC,SAAS,EAAC,uBAAuB,CAAC;;8BACrC,6LAAC,EAAE;oBAAC,SAAS,EAAC,2CAA2C;8BAAC;;;;;;gBAIzDF,MAAM,CAAC+B,MAAM,KAAK,CAAC,iBAClB,6LAAC,CAAC;oBAAC,SAAS,EAAC,iCAAiC;8BAAC;;;;;yCAI/C,6LAAC,GAAG;oBAAC,SAAS,EAAC,iBAAiB,CAAC;8BAC/B,2MAAC,KAAK;wBAAC,SAAS,EAAC,8DAA8D,CAAC;;0CAC9E,6LAAC,KAAK;gCAAC,SAAS,EAAC,6CAA6C,CAAC;wDAC7D,6LAAC,EAAE,CAAC;;sDACF,6LAAC,EAAE;4CAAC,SAAS,EAAC,qBAAqB;sDAAC,IAAI,EAAE,EAAE,CAAC;;;;;;sDAC7C,6LAAC,EAAE;4CAAC,SAAS,EAAC,qBAAqB;sDAAC,KAAK,EAAE,EAAE,CAAC;;;;;;sDAC9C,6LAAC,EAAE;4CAAC,SAAS,EAAC,uBAAuB;sDAAC,KAAK,EAAE,EAAE,CAAC;;;;;;sDAChD,6LAAC,EAAE;4CAAC,SAAS,EAAC,qBAAqB;sDAAC,OAAO,EAAE,EAAE,CAAC;;;;;;sDAChD,6LAAC,EAAE;4CAAC,SAAS,EAAC,uBAAuB;sDAAC,OAAO,EAAE,EAAE,CAAC;;;;;;sDAClD,6LAAC,EAAE;4CAAC,SAAS,EAAC,uBAAuB;sDAAC,MAAM,EAAE,EAAE,CAAC;;;;;;sDACjD,6LAAC,EAAE;4CAAC,SAAS,EAAC,uBAAuB;sDAAC,QAAQ,EAAE,EAAE,CAAC;;;;;;sDACnD,6LAAC,EAAE;4CAAC,SAAS,EAAC,uBAAuB;sDAAC,UAAU,EAAE,EAAE,CAAC;;;;;;;;;;;;;;;;;0CAIzD,6LAAC,KAAK;gCAAC,SAAS,EAAC,uBAAuB,CAAC;0CACtC/B,MAAM,CAAC4B,GAAG,EAAET,OAAK,iBAChB,6LAAC,EAAE,CACD,GAAG,CAAC;wCACJ,SAAS,EAAC,uDAAuD,CAClE;;0DAEC,6LAAC,EAAE;gDAAC,SAAS,EAAC,WAAW,CAAC;wEACxB,6LAAC,GAAG;oDAAC,SAAS,EAAC,eAAe,CAAC;;sEAC7B,6LAAC,IAAI;4DAAC,SAAS,EAAC,eAAe,CAAC;sEAC7BA,OAAK,CAACZ,MAAM,EAAEyB,QAAQ,IAAI,KAAK,CAAC;;;;;;sEAEnC,6LAAC,IAAI;4DAAC,SAAS,EAAC,uBAAuB,CAAC;sEACrCb,OAAK,CAACZ,MAAM,EAAE0B,KAAK,IAAI,UAAU,CAAC;;;;;;;;;;;;;;;;;0DAMzC,6LAAC,EAAE;gDAAC,SAAS,EAAC,WAAW,CAAC;0DACvBd,OAAK,CAACe,KAAK,EAAEN,GAAG,CAAC,CAACO,IAAI,EAAEC,CAAC,iBACxB,6LAAC,GAAG,CAAC,GAAG,CAAC;;4DACND,IAAI,CAACE,IAAI,IAAI,MAAM;4DAAC,IAAI;4DAACF,IAAI,CAACG,KAAK,IAAI,CAAC,CAAC;;uDADlCF,CAAC,CAAC,CAAC;;;;;;;;;;0DAOjB,6LAAC,EAAE;gDAAC,SAAS,EAAC,mDAAmD;;oDAAC;oDAC9DjB,OAAK,CAACoB,WAAW,CAAC;;;;;;;0DAItB,6LAAC,EAAE;gDAAC,SAAS,EAAC,WAAW,CAAC;0DAACpB,OAAK,CAACqB,OAAO,CAAC,EAAE,EAAE,CAAC;;;;;;0DAG9C,6LAAC,EAAE;gDAAC,SAAS,EAAC,uBAAuB,CAAC;0DACpC,2MAAC,GAAG;oDAAC,SAAS,EAAC,wCAAwC,CAAC;;sEACtD,6LAAC,mOAAU;4DAAC,SAAS,EAAC,eAAe;4DAAC,IAAI,CAAC,CAAC,EAAE,CAAC,GAAG;;;;;;sEAClD,6LAAC,IAAI,CAAC;sEAACrB,OAAK,CAACsB,aAAa,CAAC,EAAE,IAAI,CAAC;;;;;;;;;;;;;;;;;0DAKtC,6LAAC,EAAE;gDAAC,SAAS,EAAC,uBAAuB,CAAC;wEACpC,6LAAC,GAAG;oDAAC,SAAS,EAAC,wCAAwC,CAAC;;wDACrDX,aAAa,CAACX,OAAK,CAACO,MAAM,CAAC,CAAC;sEAC7B,6LAAC,MAAM;4DACL,KAAK,CAAC,CAACP,OAAK,CAACO,MAAM,CAAC;4DACpB,QAAQ,CAAC,EAAEgB,CAAC,GACVpB,kBAAkB,CAACH,OAAK,CAACN,GAAG,EAAE6B,CAAC,CAACC,MAAM,CAACC,KAAK,CAC9C,CAAC;4DACD,QAAQ,CAAC,CAACxC,UAAU,KAAKe,OAAK,CAACN,GAAG,CAAC;4DACnC,SAAS,CAAC,CAAC,CAAA,iDAAA,EACTM,OAAK,CAACO,MAAM,KAAK,SAAS,GACtB,mCAAmC,GACnC,iCAAiC,EACrC,CAAC,CACJ;;8EACC,6LAAC,MAAM;oEAAC,KAAK,EAAC,SAAS;8EAAC,OAAO,EAAE,MAAM,CAAC;;;;;;8EACxC,6LAAC,MAAM;oEAAC,KAAK,EAAC,WAAW;8EAAC,SAAS,EAAE,MAAM,CAAC;;;;;;8EAC5C,6LAAC,MAAM;oEAAC,KAAK,EAAC,WAAW;8EAAC,SAAS,EAAE,MAAM,CAAC;;;;;;;;;;;;wDAG7CtB,UAAU,KAAKe,OAAK,CAACN,GAAG,kBACvB,6LAAC,+NAAO;4DACN,SAAS,EAAC,4BAA4B;4DACtC,IAAI,CAAC,CAAC,EAAE,CAAC,GAEZ,CAAC;;;;;;;;;;;;;;;;;0DAKN,6LAAC,EAAE;gDAAC,SAAS,EAAC,+CAA+C,CAAC;0DAC3DM,OAAK,CAAC0B,eAAe,CAAC;;;;;;0DAIzB,6LAAC,EAAE;gDAAC,SAAS,EAAC,qCAAqC,CAAC;0DACjD,IAAIC,IAAI,CAAC3B,OAAK,CAAC4B,SAAS,CAAC,CAACC,cAAc,CAAC,CAAC,CAAC;;;;;;;uCA7EzC7B,OAAK,CAACN,GAAG,CAAC;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAwFnC;;KApNwBd,UAAUA,CAAA,EAAG","ignoreList":[],"debugId":null}}]
}